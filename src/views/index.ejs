<!DOCTYPE html>
<html lang="en">

<head>
  <% include partials/head %>
</head>



<body class="container">

  <style>
    #chartdiv {
      width: 100%;
      height: 300px;
    }
  </style>
  <h1>Hello <%= username %></h1>



  <div class="row">
    <div class="col-10">
      <!--Col Val -->
      <div class="row">
        <div class="col-4">
          <div class="list-group" id="list-tab" role="tablist">
            <a class="list-group-item list-group-item-action active" id="list-home-list" data-toggle="list"
              href="#list-home" role="tab" aria-controls="home">User Info</a>
            <a class="list-group-item list-group-item-action" id="list-profile-list" data-toggle="list"
              href="#list-profile" role="tab" aria-controls="profile">Edit User</a>
            <a class="list-group-item list-group-item-action" id="list-messages-list" data-toggle="list"
              href="#list-messages" role="tab" aria-controls="messages">Delete User</a>
            <a class="list-group-item list-group-item-action" id="list-show-metrics-list" data-toggle="list"
              href="#list-show-metrics" role="tab" aria-controls="ShowMetrics">Show Metrics</a>
            <a class="list-group-item list-group-item-action" id="list-create-metrics-list" data-toggle="list"
              href="#list-create-metrics" role="tab" aria-controls="CreateMetrics">Create Metrics</a>
          </div>
        </div>
        <div class="col-8">
          <div class="tab-content" id="nav-tabContent">
            <div class="tab-pane fade show active" id="list-home" role="tabpanel" aria-labelledby="list-home-list">
              <h3>User Info</h3>
              <div><b>Username: </b><%= username%></div>
              <div><b>Email: </b><%= email%></div>


            </div>
          </div>
          <div class="tab-pane fade" id="list-profile" role="tabpanel" aria-labelledby="list-profile-list">
            <h3>User Edit</h3>


          </div>
          <div class="tab-pane fade" id="list-messages" role="tabpanel" aria-labelledby="list-messages-list">
            <h3>Delete User</h3>
          </div>
          <div class="tab-pane fade" id="list-show-metrics" role="tabpanel" aria-labelledby="list-show-metrics-list">
            <h3>Show My metrics</h3>

            <div class="col-md-6 col-md-offset-3">

              <button class="btn btn-success" id="show-metrics">
                Bring the metrics
              </button>

              <div id="chartdiv"></div>


              <table class="table" id="my-table">
                <thead>
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">Timestamp</th>
                    <th scope="col">Value</th>
                    <th scope="col">Delete</th>
                  </tr>
                </thead>
                <tbody id="fill-data-table">
                 
                </tbody>
              </table>

            </div>

          </div>
          <div class="tab-pane fade" id="list-create-metrics" role="tabpanel"
            aria-labelledby="list-create-metrics-list">
            <h3>Create metrics</h3>

            <div class="col-md-6 col-md-offset-3">

              <input type='date' id='date-value'>
              <input type='number' id='metric-value'>
              <button onClick='checkDateValue()'> Submit </button>

              <div>Timestamp:- <span id='date-value-timestamp'></span></div>

              <button class="btn btn-success" id="create-metrics">
                Bring the metrics
              </button>

              <div id="metrics"></div>
            </div>

          </div>
        </div>
      </div>
    </div>

  </div>
  <div class="col-2">
    <!--Col Val -->
    <button class="btn btn-danger" href="/logout" onClick='document.location.href="/logout"'>
      Logout
    </button>
  </div>
  </div>






  <div id="chartContainer" style="height: 300px; width: 100%;"></div>



</body>

</html>
<script>
  /*  $('#show-metrics').click((e) => {
        e.preventDefault();
        $.getJSON("/metrics.json", {}, (data) => {
            const content = data.map(d => {
                return 'timestamp: ' + d.timestamp + ', value: ' + d.value + '';
            })
            $('#metrics').append(content.join("\n"));
        });
    })   */

  /*  $('#show-metrics').click((e) => {
      e.preventDefault();
      $.getJSON("user/kad", {}, (data) => {
          console.log(data.username);
          console.log(data);
          $('username').val(data.username);
          $('email').val(data.email); 
          $('password').val(data.password);
      });
  }) */

  function checkDateValue() {
    var dateConvertedToTimestamp = (+new Date(document.getElementById('date-value').value));

    document.getElementById('date-value-timestamp').innerHTML = dateConvertedToTimestamp;
  }

  // --- Show all metric ---
  //  ----------------------- 



  $('#show-metrics').click((e) => {
    $.get("/metrics", function (data) {
      console.log(data);
      let timestampValueArr = [];
      let timestampValueObj = {};

      for (let i = 0; i < data.length; i++) {
        // timestampValueObj.timestamp = data[i].timestamp;
        // timestampValueObj.value = data[i].value;
        timestampValueArr.push({ "timestamp": parseInt(data[i].timestamp), "value": parseInt(data[i].value) });
        console.log(timestampValueArr);
      }

      var chart = AmCharts.makeChart("chartdiv", {
        "type": "serial",
        "theme": "light",
        "dataProvider": timestampValueArr,
        "graphs": [{
          "bullet": "round",
          "type": "smoothedLine",
          "valueField": "value"
        }],
        "categoryField": "timestamp",
        "categoryAxis": {
          "parseDates": true,
          "minPeriod": "fff"
        }
      });

      let countNumber = 0;
      const content = data.map(d => {
        return '<tr>' +
          '<th scope="row">' + (countNumber++) + '</th>' +
          '<td>' + d.timestamp + '</td>' +
          '<td>' + d.value + '</td>' +
          '<td>' +
            '<button type="button" class="btn btn-danger" id="delete-metric-value'+ (countNumber++) +'">Remove</button>'+
            '</td>' +
          '</tr>';
      })
      $('#fill-data-table').append(content.join("\n"));
 //     '<button type="button" class="btn btn-danger" id="delete-metric-value'+ (countNumber++) +'">Remove</button>'+
//      <button  type="button" class="btn btn-danger" id="delete-metric-value'+ (countNumber++) +'"><span class="glyphicon glyphicon-remove"></span> HEllo</button> </td>' +



    });
  })

  $('#my-table').click((e) => {
    
  })

  $('#my-table').on('click','tr,td', function() {
    console.log( $(this).text() );
    //alert( $( this ).text() );
  });

  function deleteMetirc(username){
    console.log(username);
  }
 

  // --- Creates new metric ---
  // -------------------------- 

  $('#create-metrics').click((e) => {
    console.log("Hello");
    let data = {};
    console.log((+new Date(document.getElementById('date-value').value)));
    data.timestamp = (+new Date(document.getElementById('date-value').value));
    data.value = $('#metric-value').val();
    console.log(data);
    $.ajax({
      type: "POST",
      url: "/metrics/2",
      // The key needs to match your method's input parameter (case-sensitive).
      data: JSON.stringify(data),
      contentType: "application/json; charset=utf-8",
      dataType: "json",
      success: function (data) {
        console.log(data);

      },
      failure: function (errMsg) {
        alert(errMsg);
      }
    })
  })

</script>

<!-- <script src="/js/jquery-3.4.1.min.js"></script> -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.js"></script>

<!-- https://canvasjs.com/docs/charts/basics-of-creating-html5-chart/date-time-axis/ -->

<script type="text/javascript">
  window.onload = function () {
    var chart = new CanvasJS.Chart("chartContainer",
      {
        title: {
          text: "Simple Date-Time Chart"
        },
        axisX: {
          title: "timeline",
          gridThickness: 2
        },
        axisY: {
          title: "Downloads"
        },
        data: [
          {
            type: "area",
            dataPoints: [//array
              { x: new Date(2012, 01, 1), y: 26 },
              { x: new Date(2012, 01, 3), y: 38 },
              { x: new Date(2012, 01, 5), y: 43 },
              { x: new Date(2012, 01, 7), y: 29 },
              { x: new Date(2012, 01, 11), y: 41 },
              { x: new Date(2012, 01, 13), y: 54 },
              { x: new Date(2012, 01, 20), y: 66 },
              { x: new Date(2012, 01, 21), y: 60 },
              { x: new Date(2012, 01, 25), y: 53 },
              { x: new Date(2012, 01, 27), y: 60 }

            ]
          }
        ]
      });

    chart.render();


    /*var chart = AmCharts.makeChart("chartdiv", {
      "type": "serial",
      "theme": "light",
      "dataProvider": [{
        "timestamp": 1485343314150,
        "value": 3
      }, {
        "timestamp": 1485343314300,
        "value": 2
      }, {
        "timestamp": 1485343314400,
        "value": 1
      }, {
        "timestamp": 1485343314450,
        "value": 1
      }],
      "graphs": [{
        "bullet": "round",
        "type": "smoothedLine",
        "valueField": "value"
      }],
      "categoryField": "timestamp",
      "categoryAxis": {
        "parseDates": true,
        "minPeriod": "fff"
      }
    });*/



  }
</script>
<script type="text/javascript" src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>

<script src="//www.amcharts.com/lib/3/amcharts.js"></script>
<script src="//www.amcharts.com/lib/3/serial.js"></script>
<script src="//www.amcharts.com/lib/3/themes/light.js"></script>